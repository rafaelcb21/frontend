<div class="data-table-container">
  <table class="data-table">
    <thead>
      <tr class="header-row">
        @for (col of columnConfig; track col.key) {
          <th 
            [style.width.px]="col.widthPx"
            [attr.aria-sort]="sortKey() === col.key ? sortDir() : null">
            <div class="header-cell">
              <span>{{ col.label }}</span>
              @if (col.sortable) {
                <button 
                  class="sort-button" 
                  (click)="toggleSort(col.key)"
                  [attr.aria-label]="'Ordenar por ' + col.label">
                  <span class="sort-icon" [class.active]="sortKey() === col.key">
                    <span class="arrow up" [class.active]="sortKey() === col.key && sortDir() === 'asc'"></span>
                    <span class="arrow down" [class.active]="sortKey() === col.key && sortDir() === 'desc'"></span>
                  </span>
                </button>
              }
            </div>
          </th>
        }
      </tr>
      <tr class="filter-row">
        @for (col of columnConfig; track col.key) {
          <th>
            @if (col.filterable) {
              <input 
                type="text"
                class="filter-input"
                (input)="applyFilter(col.key, $event.target.value)"
                [value]="filters()[col.key] || ''"
                [attr.aria-label]="'Filtrar por ' + col.label">
            }
          </th>
        }
      </tr>
    </thead>
    <tbody>
      @for (row of pagedData(); track row.id) {
        <tr 
          [class.clickable]="!!rowNavigate"
          [ngClass]="rowClass ? rowClass(row) : null"
          (click)="navigateToRow(row)">
          @for (col of columnConfig; track col.key) {
            <td 
              [class.clickable]="!!col.navigate"
              (click)="onCellClick($event, row, col.key, col)">
              @if (col.cellTemplate) {
                <span [innerHTML]="col.cellTemplate(row[col.key], row)"></span>
              } @else {
                {{ row[col.key] }}
              }
            </td>
          }
        </tr>
      }
      @if (!pagedData().length) {
        <tr class="empty-row">
          <td [attr.colspan]="columnConfig?.length || 0" class="empty-message">
            Nenhum dado encontrado
          </td>
        </tr>
      }
    </tbody>
    <tfoot>
      <tr>
        <td [attr.colspan]="columnConfig?.length || 0">
          <div class="pagination-controls">
            <div class="pagination-info">
              <span>Página {{ pageIndex() + 1 }} de {{ totalPages() || 1 }}</span>
            </div>
            <div class="pagination-actions">
              <button class="pagination-button" 
                      (click)="prevPage()" 
                      [disabled]="pageIndex() === 0"
                      aria-label="Página anterior">
                Anterior
              </button>
              <button class="pagination-button" 
                      (click)="nextPage()" 
                      [disabled]="pageIndex() >= totalPages() - 1"
                      aria-label="Próxima página">
                Próximo
              </button>
            </div>
            <div class="page-size-selector">
              <label for="pageSize">Itens por página:</label>
              <select id="pageSize" 
                      [ngModel]="pageSizeSignal()" 
                      (ngModelChange)="setPageSize($event)"
                      aria-label="Selecionar quantidade de itens por página">
                @for (size of pageSizeOptions; track size) {
                  <option [value]="size">{{ size }}</option>
                }
              </select>
            </div>
          </div>
        </td>
      </tr>
    </tfoot>
  </table>
</div>